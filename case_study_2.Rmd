---
title: "case_study_2"
author: "Travis Deason"
date: "12/4/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE}
rm( list = ls()); cat("\014")  # Clear environment
#install.packages('tidyr')
#install.packages('dplyr')
#install.packages('ggplot2')
library(tidyr)
library(dplyr)
library(ggplot2)
data <- read.csv('data/CaseStudy2-data.csv')
describe_data <- read.csv('data/CaseStudy2-descriptions.csv')
#names(describe_data) <- (names(describe_data), tolower)
names(data) <- sapply(names(data), tolower)
```
## Project Goals

* Identify (at least) the top three factors that contribute to turnover.

* Learn about any job role specific trends that may exist in the data set

* Provide any other interesting trends and observations from your analysis

```{r echo=TRUE }
## this doesn't really seem needed yet... just know lower is better
labels <- sapply(unique(describe_data$X), tolower)
describe_clean <- fill(describe_data, X, .direction='up')
dump <- describe_data[6,1]
is(dump)
```

```{r echo=TRUE}
str(data)
```

* First, find out the base attrition rate

```{r}
na_count <- sum(is.na(data$attrition))
## Convert data Attrition to binary
data$attrition <- data$attrition == 'Yes'
## N/A Count
print(sum(na_count))
## Sum of Employees who quit
print(sum(data$attrition))
## retain ratio
overall_ratio <- sum(na_count) / length(data$attrition)
print(overall_ratio)
```

* So, there are no N/A values in attrition
* 237 total employees quit out of 1470 total (which is 16.122 percent)

* Now (since all values are integers) lets treat all values as catagorical, and find out which of them have a higher then expected corelation with \

```{r}
num_obs= c()
for (col in names(data))
 ## this is not needed since there are no N/A values in the dataset
 # unique_vals[paste(col, 'isna', sep='#')] = sum(is.na(data[,col])) / 1470
  {for (value in unique(data[,col]))
    {
    num_obs[paste(col, value, sep='&')] = sum(data[,col] == value)
    }
  }
```


```{r}
percent_quit = c()
find_percent <- function(df, sub_df, col_value, num_observations)
  {
  colval <- unlist(strsplit(col_value, '&'))
  return(sum(sub_df[,colval[1]] == colval[2])  / num_observations)
}
```


```{r}
#for (row in num_observations){print(row)}
percent_quit = c()
sub_df <- subset(data, attrition == TRUE)
for (colval in names(num_obs)){
  percent_quit[colval] = find_percent(data, sub_df, colval, num_obs[colval])}
```


```{r}
## create a dataframe of percent_quit verses number of observations
attr_frame <- data.frame(percent_quit, num_obs)
high_prob <- subset(attr_frame, percent_quit > overall_ratio & num_obs > 5)
high_prob$ratio_delta = high_prob$percent_quit - overall_ratio
high_prob[order(-percent_quit),]
```


```{r}
hist(data$percentsalaryhike)
```






* Taking care of all the catagorical variables

```{r}
print(unique(data$businesstravel)) # sequential data, can be assigned nums
print(unique(data$department)) ## Dummy for:
## Sales                  Research & Development Human Resources       
# Human Resources Research & Development Sales
##
print(unique(data$educationfield)) ## Dummy for:
## Life Sciences    Other            Medical          Marketing        Technical Degree
## Default: Human Resources
print(unique(data$gender)) ## Dummy value for is_female
print(unique(data$jobrole)) ## Dummy for:
## Sales Executive           Research Scientist        Laboratory Technician    
## Manufacturing Director    Healthcare Representative Manager                  
## Sales Representative      Research Director
## Default: Human Resources
print(unique(data$maritalstatus)) # dummy for married or divorced; single=default
print(unique(data$over18)) # there is only one level, omit this variable
print(unique(data$overtime)) #create dummy variable for yes overtime
```

```{r}
#check_corr <- function(col, label)
```

